{"version":3,"file":"pro-columns.cjs","sources":["../strategy/index.ts","../lib/columns.ts","../lib/component.ts"],"sourcesContent":["import { ProColumnsType } from \"../type\";\n\n// 策略合并\nconst merge = (ori: ProColumnsType.ColumnType, cur: ProColumnsType.Strategy): ProColumnsType.Strategy => {\n    // 如果原始 column 没有策略，直接返回当前策略\n    if (!ori.strategys || ori.strategys.length === 0) {\n        return cur\n    }\n\n    // 根据模式处理\n    if (cur.mode === 'replace') {\n        // replace 模式：直接返回当前策略\n        return cur\n    } else {\n        // merge 模式：合并所有策略函数\n        const mergedStrategies: ProColumnsType.StrategyItem[] = []\n\n        // 收集所有已存在的策略函数\n        ori.strategys.forEach(s => {\n            mergedStrategies.push(...s.strategy)\n        })\n\n        // 添加当前策略函数\n        mergedStrategies.push(...cur.strategy)\n\n        return {\n            mode: 'merge',\n            strategy: mergedStrategies\n        }\n    }\n}\n\n// 策略执行\nconst execute = (column: ProColumnsType.ColumnType, strategys: ProColumnsType.Strategy[]): ProColumnsType.ColumnType => {\n    let result = { ...column }\n\n    // 遍历所有策略配置\n    strategys.forEach(strategyConfig => {\n        // 执行该策略配置中的所有策略函数\n        strategyConfig.strategy.forEach(strategyFn => {\n            // 每个策略函数接收当前 column，返回处理后的 column\n            const processed = strategyFn(result)\n            // 合并处理结果\n            result = { ...result, ...processed }\n        })\n    })\n\n    // 清除策略配置，避免输出时包含\n    delete result.strategys\n\n    return result\n}\n\n// 策略类\nconst Strategy = (columns: ProColumnsType.ColumnType[]): ProColumnsType.ColumnType[] => {\n    // 复制一份数据\n    const copyColumns = columns.map(column => ({ ...column }))\n    return copyColumns.map(column => {\n        if (column.strategys) {\n            column.strategys = column.strategys.map(strategy => {\n                return merge(column, strategy)\n            })\n            return execute(column, column.strategys)\n        }\n        return column\n    })\n}\n\nexport default Strategy\n\n// 导出所有策略\nexport { default as Search } from './Search'\nexport { default as Sort } from './Sort'\nexport { default as Required } from './Required'\nexport { default as Placeholder } from './Placeholder'\n\n// 导出策略工具函数\nexport * from './utils'","import Strategy from '../strategy'\nimport { ProColumnsType } from '../type'\n\nexport type ColumnsProps = {\n  columns: ProColumnsType.ColumnType[]\n  enums?: Record<string, any>\n}\n\n/**\n * Columns 处理器\n * 功能：\n * 1. 处理 enums 映射：将字段中的 enumKey 转换为实际的 valueEnum\n * 2. 应用策略处理：通过 Strategy 处理器应用所有配置的策略\n * 3. 返回处理后的 columns\n */\nconst Columns = (props: ColumnsProps): ProColumnsType.ColumnType[] => {\n  const { columns, enums = {} } = props\n\n  // 1. 处理 enums 映射\n  const columnsWithEnums = columns.map((column) => {\n    const processedColumn = { ...column }\n\n    // 如果 column 中有 enumKey，则从 enums 中查找对应的枚举值\n    if ('enumKey' in processedColumn && processedColumn.enumKey) {\n      const enumKey = processedColumn.enumKey as string\n      if (enums[enumKey]) {\n        processedColumn.valueEnum = enums[enumKey]\n      }\n      // 删除 enumKey，避免传递给组件\n      delete (processedColumn as any).enumKey\n    }\n\n    return processedColumn\n  })\n\n  // 2. 应用策略处理\n  const processedColumns = Strategy(columnsWithEnums)\n\n  return processedColumns\n}\n\nexport default Columns","import { ProColumnsType } from '../type'\n\n/**\n * 组件适配器类型\n * 每个组件适配器需要实现 transform 方法，将通用的 columns 转换为特定组件的 columns 格式\n */\nexport type ComponentAdapter<T = any> = {\n  /**\n   * 组件名称\n   */\n  name: string\n  /**\n   * 转换函数：将通用 columns 转换为组件特定的 columns\n   */\n  transform: (columns: ProColumnsType.ColumnType[]) => T[]\n}\n\n/**\n * 组件适配器注册表\n */\nconst adapters: Map<string, ComponentAdapter> = new Map()\n\n/**\n * Component 组件管理器\n */\nconst Component = {\n  /**\n   * 注册组件适配器\n   * @param adapter 组件适配器\n   */\n  register(adapter: ComponentAdapter) {\n    adapters.set(adapter.name, adapter)\n  },\n\n  /**\n   * 获取组件适配器\n   * @param name 组件名称\n   */\n  getAdapter(name: string): ComponentAdapter | undefined {\n    return adapters.get(name)\n  },\n\n  /**\n   * 转换 columns 为指定组件的格式\n   * @param name 组件名称\n   * @param columns 原始 columns\n   */\n  transform<T = any>(name: string, columns: ProColumnsType.ColumnType[]): T[] {\n    const adapter = this.getAdapter(name)\n    if (!adapter) {\n      console.warn(`Component adapter \"${name}\" not found, returning original columns`)\n      return columns as any\n    }\n    return adapter.transform(columns)\n  },\n\n  /**\n   * 获取所有已注册的适配器名称\n   */\n  getAdapterNames(): string[] {\n    return Array.from(adapters.keys())\n  },\n\n  /**\n   * 清空所有适配器（主要用于测试）\n   */\n  clear() {\n    adapters.clear()\n  },\n}\n\nexport default Component"],"names":["merge","ori","cur","mergedStrategies","execute","column","strategys","result","strategyConfig","strategyFn","processed","Strategy","columns","strategy","Columns","props","enums","columnsWithEnums","processedColumn","enumKey","adapters","Component","adapter","name"],"mappings":"gFAGA,MAAMA,EAAQ,CAACC,EAAgCC,IAA0D,CAOrG,GALI,CAACD,EAAI,WAAaA,EAAI,UAAU,SAAW,GAK3CC,EAAI,OAAS,UAEb,OAAOA,EACJ,CAEH,MAAMC,EAAkD,CAAA,EAGxD,OAAAF,EAAI,UAAU,QAAQ,GAAK,CACvBE,EAAiB,KAAK,GAAG,EAAE,QAAQ,CACvC,CAAC,EAGDA,EAAiB,KAAK,GAAGD,EAAI,QAAQ,EAE9B,CACH,KAAM,QACN,SAAUC,CAAA,CAElB,CACJ,EAGMC,EAAU,CAACC,EAAmCC,IAAoE,CACpH,IAAIC,EAAS,CAAE,GAAGF,CAAA,EAGlB,OAAAC,EAAU,QAAQE,GAAkB,CAEhCA,EAAe,SAAS,QAAQC,GAAc,CAE1C,MAAMC,EAAYD,EAAWF,CAAM,EAEnCA,EAAS,CAAE,GAAGA,EAAQ,GAAGG,CAAA,CAC7B,CAAC,CACL,CAAC,EAGD,OAAOH,EAAO,UAEPA,CACX,EAGMI,EAAYC,GAEMA,EAAQ,QAAe,CAAE,GAAGP,GAAS,EACtC,IAAIA,GACfA,EAAO,WACPA,EAAO,UAAYA,EAAO,UAAU,IAAIQ,GAC7Bb,EAAMK,EAAQQ,CAAQ,CAChC,EACMT,EAAQC,EAAQA,EAAO,SAAS,GAEpCA,CACV,EClDCS,EAAWC,GAAqD,CACpE,KAAM,CAAE,QAAAH,EAAS,MAAAI,EAAQ,CAAA,GAAOD,EAG1BE,EAAmBL,EAAQ,IAAKP,GAAW,CAC/C,MAAMa,EAAkB,CAAE,GAAGb,CAAA,EAG7B,GAAI,YAAaa,GAAmBA,EAAgB,QAAS,CAC3D,MAAMC,EAAUD,EAAgB,QAC5BF,EAAMG,CAAO,IACfD,EAAgB,UAAYF,EAAMG,CAAO,GAG3C,OAAQD,EAAwB,OAClC,CAEA,OAAOA,CACT,CAAC,EAKD,OAFyBP,EAASM,CAAgB,CAGpD,ECnBMG,MAA8C,IAK9CC,EAAY,CAKhB,SAASC,EAA2B,CAClCF,EAAS,IAAIE,EAAQ,KAAMA,CAAO,CACpC,EAMA,WAAWC,EAA4C,CACrD,OAAOH,EAAS,IAAIG,CAAI,CAC1B,EAOA,UAAmBA,EAAcX,EAA2C,CAC1E,MAAMU,EAAU,KAAK,WAAWC,CAAI,EACpC,OAAKD,EAIEA,EAAQ,UAAUV,CAAO,GAH9B,QAAQ,KAAK,sBAAsBW,CAAI,yCAAyC,EACzEX,EAGX,EAKA,iBAA4B,CAC1B,OAAO,MAAM,KAAKQ,EAAS,KAAA,CAAM,CACnC,EAKA,OAAQ,CACNA,EAAS,MAAA,CACX,CACF"}