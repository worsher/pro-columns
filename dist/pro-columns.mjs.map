{"version":3,"file":"pro-columns.mjs","sources":["../strategy/index.ts","../lib/columns.ts","../lib/component.ts"],"sourcesContent":["import { ProColumnsType } from \"../type\";\n\n// 策略合并\nconst merge = (ori: ProColumnsType.ColumnType, cur: ProColumnsType.Strategy): ProColumnsType.Strategy => {\n    // 如果原始 column 没有策略，直接返回当前策略\n    if (!ori.strategys || ori.strategys.length === 0) {\n        return cur\n    }\n\n    // 根据模式处理\n    if (cur.mode === 'replace') {\n        // replace 模式：直接返回当前策略\n        return cur\n    } else {\n        // merge 模式：合并所有策略函数\n        const mergedStrategies: ProColumnsType.StrategyItem[] = []\n\n        // 收集所有已存在的策略函数\n        ori.strategys.forEach(s => {\n            mergedStrategies.push(...s.strategy)\n        })\n\n        // 添加当前策略函数\n        mergedStrategies.push(...cur.strategy)\n\n        return {\n            mode: 'merge',\n            strategy: mergedStrategies\n        }\n    }\n}\n\n// 策略执行\nconst execute = (\n    column: ProColumnsType.ColumnType,\n    strategys: ProColumnsType.Strategy[],\n    scene?: ProColumnsType.Scene\n): ProColumnsType.ColumnType => {\n    let result = { ...column }\n\n    // 遍历所有策略配置\n    strategys.forEach(strategyConfig => {\n        // 检查策略是否适用于当前场景\n        if (strategyConfig.scene) {\n            const allowedScenes = Array.isArray(strategyConfig.scene)\n                ? strategyConfig.scene\n                : [strategyConfig.scene]\n\n            // 如果指定了场景，但当前场景不在列表中，则跳过\n            if (scene && !allowedScenes.includes(scene)) {\n                return\n            }\n        }\n\n        // 执行该策略配置中的所有策略函数\n        strategyConfig.strategy.forEach(strategyFn => {\n            // 每个策略函数接收当前 column 和场景，返回处理后的 column\n            const processed = strategyFn(result, scene)\n            // 合并处理结果\n            result = { ...result, ...processed }\n        })\n    })\n\n    // 清除策略配置，避免输出时包含\n    delete result.strategys\n\n    return result\n}\n\n// 策略类\nconst Strategy = (\n    columns: ProColumnsType.ColumnType[],\n    scene?: ProColumnsType.Scene\n): ProColumnsType.ColumnType[] => {\n    // 复制一份数据\n    const copyColumns = columns.map(column => ({ ...column }))\n    return copyColumns.map(column => {\n        if (column.strategys) {\n            column.strategys = column.strategys.map(strategy => {\n                return merge(column, strategy)\n            })\n            return execute(column, column.strategys, scene)\n        }\n        return column\n    })\n}\n\nexport default Strategy\n\n// 导出所有策略\nexport { default as Search } from './Search'\nexport { default as Sort } from './Sort'\nexport { default as Required } from './Required'\nexport { default as Placeholder } from './Placeholder'\nexport { default as Format } from './Format'\nexport { default as Tooltip } from './Tooltip'\nexport { default as DefaultValue } from './DefaultValue'\nexport { default as Width } from './Width'\n\n// 导出策略工具函数\nexport * from './utils'","import Strategy from '../strategy'\nimport { ProColumnsType } from '../type'\n\nexport type ColumnsProps = {\n  columns: ProColumnsType.ColumnType[]\n  enums?: Record<string, any>\n  scene?: ProColumnsType.Scene // 可选场景参数\n}\n\n/**\n * Columns 处理器\n * 功能：\n * 1. 处理 enums 映射：将字段中的 enumKey 转换为实际的 valueEnum\n * 2. 应用策略处理：通过 Strategy 处理器应用所有配置的策略（支持场景）\n * 3. 返回处理后的 columns\n */\nconst Columns = (props: ColumnsProps): ProColumnsType.ColumnType[] => {\n  const { columns, enums = {}, scene } = props\n\n  // 1. 处理 enums 映射\n  const columnsWithEnums = columns.map((column) => {\n    const processedColumn = { ...column }\n\n    // 如果 column 中有 enumKey，则从 enums 中查找对应的枚举值\n    if ('enumKey' in processedColumn && processedColumn.enumKey) {\n      const enumKey = processedColumn.enumKey as string\n      if (enums[enumKey]) {\n        processedColumn.valueEnum = enums[enumKey]\n      }\n      // 删除 enumKey，避免传递给组件\n      delete (processedColumn as any).enumKey\n    }\n\n    return processedColumn\n  })\n\n  // 2. 应用策略处理（传入场景参数）\n  const processedColumns = Strategy(columnsWithEnums, scene)\n\n  return processedColumns\n}\n\nexport default Columns","import { ProColumnsType } from '../type'\nimport Columns from './columns'\n\n/**\n * 组件适配器类型\n * 每个组件适配器需要实现 transform 方法，将通用的 columns 转换为特定组件的 columns 格式\n */\nexport type ComponentAdapter<T = any> = {\n  /**\n   * 组件名称\n   */\n  name: string\n  /**\n   * 对应的场景（用于自动推断）\n   */\n  scene?: ProColumnsType.Scene\n  /**\n   * 转换函数：将通用 columns 转换为组件特定的 columns\n   */\n  transform: (columns: ProColumnsType.ColumnType[]) => T[]\n}\n\n/**\n * 组件适配器注册表\n */\nconst adapters: Map<string, ComponentAdapter> = new Map()\n\n/**\n * 组件名称到场景的默认映射\n */\nconst sceneMap: Record<string, ProColumnsType.Scene> = {\n  proTable: 'table',\n  proForm: 'form',\n  proDescription: 'description',\n}\n\n/**\n * Component 组件管理器\n */\nconst Component = {\n  /**\n   * 注册组件适配器\n   * @param adapter 组件适配器\n   */\n  register(adapter: ComponentAdapter) {\n    adapters.set(adapter.name, adapter)\n  },\n\n  /**\n   * 获取组件适配器\n   * @param name 组件名称\n   */\n  getAdapter(name: string): ComponentAdapter | undefined {\n    return adapters.get(name)\n  },\n\n  /**\n   * 转换 columns 为指定组件的格式\n   * @param name 组件名称\n   * @param columns 原始 columns\n   * @param enums 枚举字典（可选）\n   * @param scene 场景（可选，如不提供则自动推断）\n   */\n  transform<T = any>(\n    name: string,\n    columns: ProColumnsType.ColumnType[],\n    enums?: Record<string, any>,\n    scene?: ProColumnsType.Scene\n  ): T[] {\n    const adapter = this.getAdapter(name)\n    if (!adapter) {\n      console.warn(`Component adapter \"${name}\" not found, returning original columns`)\n      return columns as any\n    }\n\n    // 推断场景：优先使用传入的 scene，其次使用适配器的 scene，最后使用默认映射\n    const inferredScene = scene || adapter.scene || sceneMap[name]\n\n    // 先应用策略处理（带场景和枚举）\n    const processedColumns = Columns({\n      columns,\n      enums,\n      scene: inferredScene,\n    })\n\n    // 再通过适配器转换格式\n    return adapter.transform(processedColumns)\n  },\n\n  /**\n   * 获取所有已注册的适配器名称\n   */\n  getAdapterNames(): string[] {\n    return Array.from(adapters.keys())\n  },\n\n  /**\n   * 清空所有适配器（主要用于测试）\n   */\n  clear() {\n    adapters.clear()\n  },\n}\n\nexport default Component"],"names":["merge","ori","cur","mergedStrategies","s","execute","column","strategys","scene","result","strategyConfig","allowedScenes","strategyFn","processed","Strategy","columns","strategy","Columns","props","enums","columnsWithEnums","processedColumn","enumKey","adapters","sceneMap","Component","adapter","name","inferredScene","processedColumns"],"mappings":"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"}