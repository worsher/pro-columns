{"version":3,"file":"pro-columns.mjs","sources":["../strategy/index.ts","../lib/columns.ts","../lib/component.ts"],"sourcesContent":["import { ProColumnsType } from \"../type\";\n\n// 策略合并\nconst merge = (ori: ProColumnsType.ColumnType, cur: ProColumnsType.Strategy): ProColumnsType.Strategy => {\n    // 如果原始 column 没有策略，直接返回当前策略\n    if (!ori.strategys || ori.strategys.length === 0) {\n        return cur\n    }\n\n    // 根据模式处理\n    if (cur.mode === 'replace') {\n        // replace 模式：直接返回当前策略\n        return cur\n    } else {\n        // merge 模式：合并所有策略函数\n        const mergedStrategies: ProColumnsType.StrategyItem[] = []\n\n        // 收集所有已存在的策略函数\n        ori.strategys.forEach(s => {\n            mergedStrategies.push(...s.strategy)\n        })\n\n        // 添加当前策略函数\n        mergedStrategies.push(...cur.strategy)\n\n        return {\n            mode: 'merge',\n            strategy: mergedStrategies\n        }\n    }\n}\n\n// 策略执行\nconst execute = (column: ProColumnsType.ColumnType, strategys: ProColumnsType.Strategy[]): ProColumnsType.ColumnType => {\n    let result = { ...column }\n\n    // 遍历所有策略配置\n    strategys.forEach(strategyConfig => {\n        // 执行该策略配置中的所有策略函数\n        strategyConfig.strategy.forEach(strategyFn => {\n            // 每个策略函数接收当前 column，返回处理后的 column\n            const processed = strategyFn(result)\n            // 合并处理结果\n            result = { ...result, ...processed }\n        })\n    })\n\n    // 清除策略配置，避免输出时包含\n    delete result.strategys\n\n    return result\n}\n\n// 策略类\nconst Strategy = (columns: ProColumnsType.ColumnType[]): ProColumnsType.ColumnType[] => {\n    // 复制一份数据\n    const copyColumns = columns.map(column => ({ ...column }))\n    return copyColumns.map(column => {\n        if (column.strategys) {\n            column.strategys = column.strategys.map(strategy => {\n                return merge(column, strategy)\n            })\n            return execute(column, column.strategys)\n        }\n        return column\n    })\n}\n\nexport default Strategy\n\n// 导出所有策略\nexport { default as Search } from './Search'\nexport { default as Sort } from './Sort'\nexport { default as Required } from './Required'\nexport { default as Placeholder } from './Placeholder'\n\n// 导出策略工具函数\nexport * from './utils'","import Strategy from '../strategy'\nimport { ProColumnsType } from '../type'\n\nexport type ColumnsProps = {\n  columns: ProColumnsType.ColumnType[]\n  enums?: Record<string, any>\n}\n\n/**\n * Columns 处理器\n * 功能：\n * 1. 处理 enums 映射：将字段中的 enumKey 转换为实际的 valueEnum\n * 2. 应用策略处理：通过 Strategy 处理器应用所有配置的策略\n * 3. 返回处理后的 columns\n */\nconst Columns = (props: ColumnsProps): ProColumnsType.ColumnType[] => {\n  const { columns, enums = {} } = props\n\n  // 1. 处理 enums 映射\n  const columnsWithEnums = columns.map((column) => {\n    const processedColumn = { ...column }\n\n    // 如果 column 中有 enumKey，则从 enums 中查找对应的枚举值\n    if ('enumKey' in processedColumn && processedColumn.enumKey) {\n      const enumKey = processedColumn.enumKey as string\n      if (enums[enumKey]) {\n        processedColumn.valueEnum = enums[enumKey]\n      }\n      // 删除 enumKey，避免传递给组件\n      delete (processedColumn as any).enumKey\n    }\n\n    return processedColumn\n  })\n\n  // 2. 应用策略处理\n  const processedColumns = Strategy(columnsWithEnums)\n\n  return processedColumns\n}\n\nexport default Columns","import { ProColumnsType } from '../type'\n\n/**\n * 组件适配器类型\n * 每个组件适配器需要实现 transform 方法，将通用的 columns 转换为特定组件的 columns 格式\n */\nexport type ComponentAdapter<T = any> = {\n  /**\n   * 组件名称\n   */\n  name: string\n  /**\n   * 转换函数：将通用 columns 转换为组件特定的 columns\n   */\n  transform: (columns: ProColumnsType.ColumnType[]) => T[]\n}\n\n/**\n * 组件适配器注册表\n */\nconst adapters: Map<string, ComponentAdapter> = new Map()\n\n/**\n * Component 组件管理器\n */\nconst Component = {\n  /**\n   * 注册组件适配器\n   * @param adapter 组件适配器\n   */\n  register(adapter: ComponentAdapter) {\n    adapters.set(adapter.name, adapter)\n  },\n\n  /**\n   * 获取组件适配器\n   * @param name 组件名称\n   */\n  getAdapter(name: string): ComponentAdapter | undefined {\n    return adapters.get(name)\n  },\n\n  /**\n   * 转换 columns 为指定组件的格式\n   * @param name 组件名称\n   * @param columns 原始 columns\n   */\n  transform<T = any>(name: string, columns: ProColumnsType.ColumnType[]): T[] {\n    const adapter = this.getAdapter(name)\n    if (!adapter) {\n      console.warn(`Component adapter \"${name}\" not found, returning original columns`)\n      return columns as any\n    }\n    return adapter.transform(columns)\n  },\n\n  /**\n   * 获取所有已注册的适配器名称\n   */\n  getAdapterNames(): string[] {\n    return Array.from(adapters.keys())\n  },\n\n  /**\n   * 清空所有适配器（主要用于测试）\n   */\n  clear() {\n    adapters.clear()\n  },\n}\n\nexport default Component"],"names":["merge","ori","cur","mergedStrategies","execute","column","strategys","result","strategyConfig","strategyFn","processed","Strategy","columns","strategy","Columns","props","enums","columnsWithEnums","processedColumn","enumKey","adapters","Component","adapter","name"],"mappings":"AAGA,MAAMA,IAAQ,CAACC,GAAgCC,MAA0D;AAOrG,MALI,CAACD,EAAI,aAAaA,EAAI,UAAU,WAAW,KAK3CC,EAAI,SAAS;AAEb,WAAOA;AACJ;AAEH,UAAMC,IAAkD,CAAA;AAGxD,WAAAF,EAAI,UAAU,QAAQ,CAAA,MAAK;AACvB,MAAAE,EAAiB,KAAK,GAAG,EAAE,QAAQ;AAAA,IACvC,CAAC,GAGDA,EAAiB,KAAK,GAAGD,EAAI,QAAQ,GAE9B;AAAA,MACH,MAAM;AAAA,MACN,UAAUC;AAAA,IAAA;AAAA,EAElB;AACJ,GAGMC,IAAU,CAACC,GAAmCC,MAAoE;AACpH,MAAIC,IAAS,EAAE,GAAGF,EAAA;AAGlB,SAAAC,EAAU,QAAQ,CAAAE,MAAkB;AAEhC,IAAAA,EAAe,SAAS,QAAQ,CAAAC,MAAc;AAE1C,YAAMC,IAAYD,EAAWF,CAAM;AAEnC,MAAAA,IAAS,EAAE,GAAGA,GAAQ,GAAGG,EAAA;AAAA,IAC7B,CAAC;AAAA,EACL,CAAC,GAGD,OAAOH,EAAO,WAEPA;AACX,GAGMI,IAAW,CAACC,MAEMA,EAAQ,IAAI,QAAW,EAAE,GAAGP,IAAS,EACtC,IAAI,CAAAA,MACfA,EAAO,aACPA,EAAO,YAAYA,EAAO,UAAU,IAAI,CAAAQ,MAC7Bb,EAAMK,GAAQQ,CAAQ,CAChC,GACMT,EAAQC,GAAQA,EAAO,SAAS,KAEpCA,CACV,GClDCS,IAAU,CAACC,MAAqD;AACpE,QAAM,EAAE,SAAAH,GAAS,OAAAI,IAAQ,CAAA,MAAOD,GAG1BE,IAAmBL,EAAQ,IAAI,CAACP,MAAW;AAC/C,UAAMa,IAAkB,EAAE,GAAGb,EAAA;AAG7B,QAAI,aAAaa,KAAmBA,EAAgB,SAAS;AAC3D,YAAMC,IAAUD,EAAgB;AAChC,MAAIF,EAAMG,CAAO,MACfD,EAAgB,YAAYF,EAAMG,CAAO,IAG3C,OAAQD,EAAwB;AAAA,IAClC;AAEA,WAAOA;AAAA,EACT,CAAC;AAKD,SAFyBP,EAASM,CAAgB;AAGpD,GCnBMG,wBAA8C,IAAA,GAK9CC,IAAY;AAAA;AAAA;AAAA;AAAA;AAAA,EAKhB,SAASC,GAA2B;AAClC,IAAAF,EAAS,IAAIE,EAAQ,MAAMA,CAAO;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAWC,GAA4C;AACrD,WAAOH,EAAS,IAAIG,CAAI;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAmBA,GAAcX,GAA2C;AAC1E,UAAMU,IAAU,KAAK,WAAWC,CAAI;AACpC,WAAKD,IAIEA,EAAQ,UAAUV,CAAO,KAH9B,QAAQ,KAAK,sBAAsBW,CAAI,yCAAyC,GACzEX;AAAA,EAGX;AAAA;AAAA;AAAA;AAAA,EAKA,kBAA4B;AAC1B,WAAO,MAAM,KAAKQ,EAAS,KAAA,CAAM;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ;AACN,IAAAA,EAAS,MAAA;AAAA,EACX;AACF;"}